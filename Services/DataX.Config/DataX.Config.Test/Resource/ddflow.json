{
  "name": "visualstudio",
  "icon": "/img/vs.png",
  "displayName": "Visual Studio",
  "properties": {
    "productName": "asimov.visualstudio"
  },
  "commonProcessor": {
    "sparkJobConfigFolder": "wasbs://centralprocessing@novaddconfigs.blob.core.windows.net/visualstudio",
    "template": {
      "name": "${jobName}",
      "resources": "wasbs://centralprocessing@novaddconfigs.blob.core.windows.net/nova-resources-production-kv.json",
      "input": {
        "sources": {
          "vstelraw0${sourceShardNumber}": {
            "target": "novaexternalegress${partitionJobNumber}"
          }
        },
        "eventhub": {
          "consumerGroup": "visualstudio${partitionJobNumber}-staging",
          "checkpointDir": "hdfs://mycluster/checkpoints/staging/eventhub/cp/${jobName}",
          "checkpointInterval": "300",
          "connectionString": "keyvault://NovaSparkKVddrawstg/visualstudio${partitionJobNumber}-staging-input-eventhubconnectionstring",
          "maxRate": "300",
          "partitionCount": "10",
          "startEnqueueTime": "-60"
        },
        "streaming": {
          "checkpointDir": "hdfs://mycluster/checkpoints/staging/streaming/cp/${jobName}",
          "intervalInSeconds": 300
        },
        "blobSchemaFile": "wasbs://centralprocessing@novaconfigsddrawstg.blob.core.windows.net/visualstudio/rawSchema.json",
        "eventNamePath": "data.baseData.name",
        "blobPathRegex": "^wasbs?://export@vstelraw(\\d{3})\\.blob\\.core\\.windows\\.net/raw/\\d{4}/\\d{2}/\\d{2}/\\d{2}/([\\w\\d\\-]+_VisualStudio2_[\\d_]*\\d{4}-\\d{2}-\\d{2}.[\\d_:\\.\\+]+)Z.json$",
        "fileTimeRegex": "VisualStudio2_[\\d_]*(\\d{4}-\\d{2}-\\d{2}.[\\d_:\\.\\+]+)Z\\.json$",
        "sourceIdRegex": "^wasbs?://export@(vstelraw\\d{3})\\.blob\\.core\\.windows\\.net",
        "fileTimeFormat": "yyyyMMdd_HHmmss",
        "referenceData": []
      },
      "process": {
        "metric": {
          "eventhub": "keyvault://NovaSparkKVddrawstg/metric-eventhubconnectionstring"
        },
        "transform": "wasbs://centralprocessing@novaconfigsddrawstg.blob.core.windows.net/visualstudio/transform.txt",
        "projections": [
          "wasbs://centralprocessing@novaconfigsddrawstg.blob.core.windows.net/visualstudio/projection.txt"
        ],
        "tagger": {
          "rulesfilepath": "wasbs://referencedata@novaconfigsddrawstg.blob.core.windows.net/TaggingRules.xml"
        },
        "udf": {
          "tagWorkload": "datax.devdiv.tagger.Tagger"
        }
      },
      "output": {
        "blob": {
          "groups": {
            "main": {
              "folder": "wasbs://datax@${target}.blob.core.windows.net/vsraw/json/hourly/%1$tY/%1$tm/%1$td/%1$tH/${quarterBucket}/${minuteBucket}"
            },
            "quarantined": {
              "folder": "wasbs://unclassified@${target}.blob.core.windows.net/vs/json/%1$tY/%1$tm/%1$td/%1$tH/${quarterBucket}/${minuteBucket}"
            }
          },
          "groupEvaluation": "CASE WHEN NovaDataBucket='main' THEN 'main' ELSE 'quarantined' END",
          "format": "json",
          "compressionType": "gzip"
        },
        "name": "default",
        "processedSchemaPath": "wasbs://specialprocessing@novaconfigsddrawstg.blob.core.windows.net/visualstudio/processedschema.json"
      }
    },
    "sparkJobTemplateRef": "defaultJobTemplate",
    "jobCommonTokens": {
      "jobName": "visualstudio${partitionJobNumber}",
      "sparkJobName": "visualstudio${partitionJobNumber}",
      "sparkJobConfigFileName": "visualstudio${partitionJobNumber}.json",
      "sparkJobDriverLogLevel": "WARN",
      "sparkJobExecutorLogLevel": "INFO",
      "sparkJobNumExecutors": 6,
      "sparkJobExecutorMemory": "8000m",
      "processedSchemaPath": null
    },
    "jobs": [
      {
        "sourceShardNumber": "01",
        "partitionJobNumber": "1",
        "processedSchemaPath": "wasbs://specialprocessing@novaddconfigs.blob.core.windows.net/visualstudio/processedschema.json"
      },
      {
        "sourceShardNumber": "02",
        "partitionJobNumber": "2",
        "processedSchemaPath": null
      }
    ]
  },
  "metrics": {
    "initParameters": {
      "widgetSets": [
        "direct"
      ],
      "jobNames": {
        "type": "getCPSparkJobNames"
      }
    }
  },
  "jobNames": [
    "visualstudio1",
    "visualstudio2"
  ]
}